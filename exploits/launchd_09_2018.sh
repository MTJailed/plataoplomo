#!/usr/bin/env bash

#################################################
##    Launchd Type Confusion Vulnerability     ##
##    Created by Sem Voigtl√§nder               ##
##    Licensed under the MIT License           ##
#################################################

# Exploit is still unfinished
# Please wait until I get the time to update it

IPHONE_IP=""
IPHONE_SSH_PORT=""
IPHONE_DOWNGRADE_NONCE="" # Needed as this race condition might break launchd your iphone, causing a bootloop
IPHONE_ECID=""
IPHONE_UDID=""

echo "This exploit is still unfinished, please wait for someone to finish it."
exit;

# INITIALIZATION
echo "Connecting to $IPHONE_IP:$IPHONE_SSH_PORT as root..."
echo "Fetching saved SHSH blobs..."
echo "Checking eligibility and validity of the blobs..."
echo "Setting a nonce so we can downgrade..." 
echo "Checking whether an existing untether is already installed..."

# EXPLOTATION

echo "Backing up old launchdaemon propertylist..."
afcclient get launchdaemon.plist

echo "Uploading malicious launchdaemon propertylist..."
afcclient put launchdamon.plist

echo "Rebooting to see the magic..."
idevicepair pair
idevicepair validate
idevicediagnostics restart

echo "Waiting for launchd..."
echo "Here goes the verbose log: "
idevicesyslog -d

echo "Waiting for empty_list..."
echo "Here goes the verbose log: "
idevicesyslog -d

# POSTEXPLOITATION

echo "Checking if we can launch Cydia..."
idevicediagnostics -d run com.saurik.cydia
echo "The launchd exploit has succeeded and your device is now persistantly jailbroken."


